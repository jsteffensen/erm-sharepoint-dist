import{L as N,p as H,ra as V}from"./chunk-FMDUR5PZ.js";import{$a as D,J as R,N as j,Oa as _,T as b,Tb as w,U as x,Ub as X,Va as A,Vb as B,W as T,X as U,Y as h,a,ab as q,b as m,e as I,g as L,h as C,ia as E,ja as f,na as g,nb as $,ob as z,pb as M,qc as F,ua as O,uc as S,x as P,xb as v,yb as y,zb as p}from"./chunk-2KWEBWT5.js";var G=class n{constructor(e){this.logger=e;this.config=this.getConfig(),this.logger.debugLog("Data service initialized",{environment:window.location.href.includes("localhost")?"localhost":"production",siteUrl:this.config.siteUrl,apiPath:this.config.apiPath})}config;getConfig(){return window.location.href.includes("localhost")?(this.logger.debugLog("Running in localhost development mode"),{siteUrl:"http://localhost:3000",apiPath:""}):(this.logger.debugLog("Running in production SharePoint mode"),{siteUrl:"https://collab.napma.nato.int/grc",apiPath:"/_api/web"})}cacheState=g({isInitialized:!1,lastUpdated:null,initializationError:null},{});risksState=g({isLoaded:!1,lastUpdated:null,error:null},{});objectivesState=g({isLoaded:!1,lastUpdated:null,error:null},{});criticalAssetsState=g({isLoaded:!1,lastUpdated:null,error:null},{});treatmentsState=g({isLoaded:!1,lastUpdated:null,error:null},{});userState=g({isLoaded:!1,lastUpdated:null,error:null},{});causesState=g({isLoaded:!1,lastUpdated:null,error:null},{});consequencesState=g({isLoaded:!1,lastUpdated:null,error:null},{});controlsState=g({isLoaded:!1,lastUpdated:null,error:null},{});controlCommentsState=g({isLoaded:!1,lastUpdated:null,error:null},{});controlImpactState=g({isLoaded:!1,lastUpdated:null,error:null},{});_risks=[];_objectives=[];_criticalAssets=[];_treatments=[];_causes=[];_consequences=[];_controls=[];_controlComments=[];_controlImpact=[];_user=null;_selectedRisk=null;_selectedRiskSubject=new C(null);_selectedObjective=null;_selectedObjectiveSubject=new C(null);requestDigest=null;digestExpirationTime=null;selectedRisk$=this._selectedRiskSubject.asObservable();selectedObjective$=this._selectedObjectiveSubject.asObservable();risks(){return this._risks}objectives(){return this._objectives}criticalAssets(){return this._criticalAssets}treatments(){return this._treatments}causes(){return this._causes}consequences(){return this._consequences}controls(){return this._controls}controlComments(){return this._controlComments}controlImpact(){return this._controlImpact}user(){return this._user}selectedRisk(){return this._selectedRisk}selectedObjective(){return this._selectedObjective}isInitialized(){return this.cacheState().isInitialized}lastUpdated(){return this.cacheState().lastUpdated}risksLoaded(){return this.risksState().isLoaded}objectivesLoaded(){return this.objectivesState().isLoaded}criticalAssetsLoaded(){return this.criticalAssetsState().isLoaded}treatmentsLoaded(){return this.treatmentsState().isLoaded}causesLoaded(){return this.causesState().isLoaded}consequencesLoaded(){return this.consequencesState().isLoaded}controlsLoaded(){return this.controlsState().isLoaded}controlCommentsLoaded(){return this.controlCommentsState().isLoaded}controlImpactLoaded(){return this.controlImpactState().isLoaded}userLoaded(){return this.userState().isLoaded}async initializeCache(){if(this.cacheState().isInitialized){this.logger.debugLog("Cache already initialized, skipping initialization");return}this.logger.debugLog("Starting cache initialization");try{this._user=await this.loadUser(),this.userState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("User loaded",this._user);let[e,t,s,r,d,u,o,l,i]=await Promise.all([this.loadRisks(),this.loadObjectives(),this.loadCriticalAssets(),this.loadTreatments(),this.loadCauses(),this.loadConsequences(),this.loadControls(),this.loadControlComments(),this.loadControlImpact()]);this._risks=e,this.risksState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this._objectives=t,this.objectivesState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this._criticalAssets=s,this.criticalAssetsState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this._treatments=r,this.treatmentsState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this._causes=d,this.causesState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this._consequences=u,this.consequencesState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this._controls=o,this.controlsState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this._controlComments=l,this.controlCommentsState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this._controlImpact=i,this.controlImpactState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.cacheState.set({isInitialized:!0,lastUpdated:new Date,initializationError:null}),this.logger.debugLog("Cache initialization completed successfully",{risksCount:e.length,objectivesCount:t.length,criticalAssetsCount:s.length,treatmentsCount:r.length,causesCount:d.length,consequencesCount:u.length,controlsCount:o.length,controlCommentsCount:l.length,controlImpactCount:i.length})}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.cacheState.set({isInitialized:!1,lastUpdated:null,initializationError:t}),this.logger.debugLog("Cache initialization failed",e),e}}async forceRefreshCache(){this.logger.debugLog("Force refreshing entire cache"),this.cacheState.set({isInitialized:!1,lastUpdated:null,initializationError:null}),await this.initializeCache()}async invalidateUser(){this.logger.debugLog("Invalidating user cache");try{this._user=await this.loadUser(),this.userState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("User cache refreshed",this._user)}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.userState.set({isLoaded:!1,lastUpdated:null,error:t}),this.logger.debugLog("User cache refresh failed",e),e}}async invalidateRisks(){this.logger.debugLog("Invalidating risks cache");try{this._risks=await this.loadRisks(),this.risksState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("Risks cache refreshed",{count:this._risks.length})}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.risksState.set({isLoaded:!1,lastUpdated:null,error:t}),this.logger.debugLog("Risks cache refresh failed",e),e}}async invalidateObjectives(){this.logger.debugLog("Invalidating objectives cache");try{this._objectives=await this.loadObjectives(),this.objectivesState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("Objectives cache refreshed",{count:this._objectives.length})}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.objectivesState.set({isLoaded:!1,lastUpdated:null,error:t}),this.logger.debugLog("Objectives cache refresh failed",e),e}}async invalidateCriticalAssets(){this.logger.debugLog("Invalidating critical assets cache");try{this._criticalAssets=await this.loadCriticalAssets(),this.criticalAssetsState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("Critical assets cache refreshed",{count:this._criticalAssets.length})}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.criticalAssetsState.set({isLoaded:!1,lastUpdated:null,error:t}),this.logger.debugLog("Critical assets cache refresh failed",e),e}}async invalidateTreatments(){this.logger.debugLog("Invalidating treatments cache");try{this._treatments=await this.loadTreatments(),this.treatmentsState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("Treatments cache refreshed",{count:this._treatments.length})}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.treatmentsState.set({isLoaded:!1,lastUpdated:null,error:t}),this.logger.debugLog("Treatments cache refresh failed",e),e}}async invalidateCauses(){this.logger.debugLog("Invalidating causes cache");try{this._causes=await this.loadCauses(),this.causesState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("Causes cache refreshed",{count:this._causes.length})}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.causesState.set({isLoaded:!1,lastUpdated:null,error:t}),this.logger.debugLog("Causes cache refresh failed",e),e}}async invalidateConsequences(){this.logger.debugLog("Invalidating consequences cache");try{this._consequences=await this.loadConsequences(),this.consequencesState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("Consequences cache refreshed",{count:this._consequences.length})}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.consequencesState.set({isLoaded:!1,lastUpdated:null,error:t}),this.logger.debugLog("Consequences cache refresh failed",e),e}}async invalidateControls(){this.logger.debugLog("Invalidating controls cache");try{this._controls=await this.loadControls(),this.controlsState.set({isLoaded:!0,lastUpdated:new Date,error:null}),this.logger.debugLog("Controls cache refreshed",{count:this._controls.length})}catch(e){let t=e instanceof Error?e.message:"Unknown error";throw this.controlsState.set({isLoaded:!1,lastUpdated:null,error:t}),this.logger.debugLog("Controls cache refresh failed",e),e}}clearCache(){this.logger.debugLog("Clearing cache"),this._risks=[],this._objectives=[],this._criticalAssets=[],this._treatments=[],this._user=null,this.cacheState.set({isInitialized:!1,lastUpdated:null,initializationError:null}),this.risksState.set({isLoaded:!1,lastUpdated:null,error:null}),this.objectivesState.set({isLoaded:!1,lastUpdated:null,error:null}),this.criticalAssetsState.set({isLoaded:!1,lastUpdated:null,error:null}),this.treatmentsState.set({isLoaded:!1,lastUpdated:null,error:null}),this.userState.set({isLoaded:!1,lastUpdated:null,error:null})}buildApiUrl(e){return`${this.config.siteUrl}${this.config.apiPath}${e}`}getHeaders(e){let t={Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose"};return e&&(t["X-RequestDigest"]=e),t}async getRequestDigest(e=!1){let t=Date.now();if(!e&&this.requestDigest&&this.digestExpirationTime&&t<this.digestExpirationTime)return this.logger.debugLog("Using cached request digest"),this.requestDigest;let s=`${this.config.siteUrl}/_api/contextinfo`;this.logger.debugLog("Requesting new digest from:",s);try{let r=await fetch(s,{method:"POST",headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose"},credentials:"include"});if(!r.ok){let u=await r.text();throw this.logger.debugLog("Failed to get digest",{status:r.status,statusText:r.statusText,responseBody:u}),new Error(`Failed to get request digest: ${r.status} ${r.statusText}`)}let d=await r.json();return this.requestDigest=d.d.GetContextWebInformation.FormDigestValue,this.digestExpirationTime=t+1500*1e3,this.logger.debugLog("Request digest obtained and cached successfully"),this.requestDigest}catch(r){throw this.logger.debugLog("Error getting request digest",r),r}}async executeWithDigestRetry(e,t){try{let s=await this.getRequestDigest();return await e(s)}catch(s){let r=s instanceof Error?s.message:String(s);if(r.includes("401")||r.includes("403")||r.includes("digest")){this.logger.debugLog(`${t} failed with potential digest error, retrying with fresh digest`);let u=await this.getRequestDigest(!0);return await e(u)}throw s}}async queryList(e,t,s,r,d){this.logger.debugLog(`Querying SharePoint list: ${e}`,{select:t,filter:s,orderBy:r,expand:d});let u=`/Lists/getbytitle('${e}')/Items`,o=[];t&&o.push(`$select=${t}`),s&&o.push(`$filter=${s}`),r&&o.push(`$orderby=${r}`),d&&o.push(`$expand=${d}`),o.length>0&&(u+="?"+o.join("&"));let l=this.buildApiUrl(u);this.logger.debugLog(`Fetching data from URL: ${l}`);try{let i=await fetch(l,{method:"GET",headers:this.getHeaders(),credentials:"include"});if(!i.ok){let J=await i.text();throw this.logger.debugLog("HTTP Error Details",{status:i.status,statusText:i.statusText,url:l,responseBody:J}),new Error(`SharePoint query failed: ${i.status} ${i.statusText}`)}let c=await i.json();return this.logger.debugLog(`Raw JSON response from ${e}`,c),Array.isArray(c)?c:c.d&&c.d.results?c.d.results:c.d&&Array.isArray(c.d)?c.d:(this.logger.debugLog("Unexpected response format",c),[])}catch(i){throw this.logger.debugLog(`Error querying list ${e}`,{error:i,message:i instanceof Error?i.message:String(i),stack:i instanceof Error?i.stack:void 0,url:l}),i}}async addListItem(e,t){this.logger.debugLog(`Adding item to SharePoint list: ${e}`,t);let s=`/Lists/getbytitle('${e}')/Items`,r=this.buildApiUrl(s);this.logger.debugLog(`POST request to URL: ${r}`);let d=async u=>{let o=a({__metadata:{type:`SP.Data.${e}ListItem`}},t);this.logger.debugLog("Request payload:",o);let l=await fetch(r,{method:"POST",headers:this.getHeaders(u),credentials:"include",body:JSON.stringify(o)});if(!l.ok){let c=await l.text();throw this.logger.debugLog("HTTP Error Details",{status:l.status,statusText:l.statusText,url:r,responseBody:c}),new Error(`SharePoint add failed: ${l.status} ${l.statusText} - ${c}`)}let i=await l.json();return this.logger.debugLog(`Item added successfully to ${e}`,i.d),i.d};return this.executeWithDigestRetry(d,"addListItem")}async updateListItem(e,t,s){this.logger.debugLog(`Updating item in SharePoint list: ${e}`,{itemId:t,itemData:s});let r=`/Lists/getbytitle('${e}')/Items(${t})`,d=this.buildApiUrl(r);this.logger.debugLog(`MERGE request to URL: ${d}`);let u=async o=>{let l=a({__metadata:{type:`SP.Data.${e}ListItem`}},s),i=await fetch(d,{method:"POST",headers:m(a({},this.getHeaders(o)),{"X-HTTP-Method":"MERGE","IF-MATCH":"*"}),credentials:"include",body:JSON.stringify(l)});if(!i.ok){let c=await i.text();throw this.logger.debugLog("HTTP Error Details",{status:i.status,statusText:i.statusText,url:d,responseBody:c}),new Error(`SharePoint update failed: ${i.status} ${i.statusText} - ${c}`)}this.logger.debugLog(`Item updated successfully in ${e}`,{itemId:t})};return this.executeWithDigestRetry(u,"updateListItem")}async deleteListItem(e,t){this.logger.debugLog(`Deleting item from SharePoint list: ${e}`,{itemId:t});let s=`/Lists/getbytitle('${e}')/Items(${t})`,r=this.buildApiUrl(s);this.logger.debugLog(`DELETE request to URL: ${r}`);let d=async u=>{let o=await fetch(r,{method:"POST",headers:m(a({},this.getHeaders(u)),{"X-HTTP-Method":"DELETE","IF-MATCH":"*"}),credentials:"include"});if(!o.ok){let l=await o.text();throw this.logger.debugLog("HTTP Error Details",{status:o.status,statusText:o.statusText,url:r,responseBody:l}),new Error(`SharePoint delete failed: ${o.status} ${o.statusText} - ${l}`)}this.logger.debugLog(`Item deleted successfully from ${e}`,{itemId:t})};return this.executeWithDigestRetry(d,"deleteListItem")}async loadUser(){this.logger.debugLog("Loading current user");let e=this.buildApiUrl("/currentuser");this.logger.debugLog(`Fetching current user from URL: ${e}`);try{let t=await fetch(e,{method:"GET",headers:this.getHeaders(),credentials:"include"});if(!t.ok)throw new Error(`Failed to load user: ${t.status}`);return(await t.json()).d}catch(t){throw this.logger.debugLog("Error loading user",t),t}}async loadRisks(){return this.queryList("Risks","FileSystemObjectType,Id,ServerRedirectedEmbedUri,ServerRedirectedEmbedUrl,ContentTypeId,Title,ComplianceAssetId,Category,Description,OwnerId,OwnerStringId,OrgDivision,DateIdentified,InherentLikelihood,InherentImpact,OrgUnit,ParentId,ID,Modified,Created,AuthorId,EditorId,OData__UIVersionString,Attachments,GUID,Author/Id,Author/Title,Author/Name,Author/EMail",void 0,void 0,"Author")}async loadObjectives(){return this.queryList("Objectives")}async loadCriticalAssets(){return this.queryList("CriticalAssets")}async loadTreatments(){return this.queryList("Treatments")}async loadCauses(){return this.queryList("Causes")}async loadConsequences(){return this.queryList("Consequences")}async loadControls(){return this.queryList("Controls")}async loadControlComments(){return this.queryList("ControlComments")}async loadControlImpact(){return this.queryList("ControlImpact")}async addRisk(e){let t=await this.addListItem("Risks",e);return this._risks.push(t),this.logger.debugLog("Risk added to cache",t),t}async updateRisk(e,t){await this.updateListItem("Risks",e,t);let s=this._risks.findIndex(r=>r.Id===e);s!==-1&&(this._risks[s]=a(a({},this._risks[s]),t),this.logger.debugLog("Risk updated in cache",{riskId:e}))}async deleteRisk(e){await this.deleteListItem("Risks",e),this._risks=this._risks.filter(t=>t.Id!==e),this.logger.debugLog("Risk deleted from cache",{riskId:e})}async addObjective(e){let t=await this.addListItem("Objectives",e);return this._objectives.push(t),this.logger.debugLog("Objective added to cache",t),t}async updateObjective(e,t){await this.updateListItem("Objectives",e,t);let s=this._objectives.findIndex(r=>r.Id===e);s!==-1&&(this._objectives[s]=a(a({},this._objectives[s]),t),this.logger.debugLog("Objective updated in cache",{objectiveId:e}))}async deleteObjective(e){await this.deleteListItem("Objectives",e),this._objectives=this._objectives.filter(t=>t.Id!==e),this.logger.debugLog("Objective deleted from cache",{objectiveId:e})}async addCriticalAsset(e){let t=await this.addListItem("CriticalAssets",e);return this._criticalAssets.push(t),this.logger.debugLog("Critical asset added to cache",t),t}async updateCriticalAsset(e,t){await this.updateListItem("CriticalAssets",e,t);let s=this._criticalAssets.findIndex(r=>r.Id===e);s!==-1&&(this._criticalAssets[s]=a(a({},this._criticalAssets[s]),t),this.logger.debugLog("Critical asset updated in cache",{assetId:e}))}async deleteCriticalAsset(e){await this.deleteListItem("CriticalAssets",e),this._criticalAssets=this._criticalAssets.filter(t=>t.Id!==e),this.logger.debugLog("Critical asset deleted from cache",{assetId:e})}async addTreatment(e){let t=await this.addListItem("Treatments",e);return this._treatments.push(t),this.logger.debugLog("Treatment added to cache",t),t}async updateTreatment(e,t){await this.updateListItem("Treatments",e,t);let s=this._treatments.findIndex(r=>r.Id===e);s!==-1&&(this._treatments[s]=a(a({},this._treatments[s]),t),this.logger.debugLog("Treatment updated in cache",{treatmentId:e}))}async deleteTreatment(e){await this.deleteListItem("Treatments",e),this._treatments=this._treatments.filter(t=>t.Id!==e),this.logger.debugLog("Treatment deleted from cache",{treatmentId:e})}async addCause(e){let t=await this.addListItem("Causes",e);return this._causes.push(t),this.logger.debugLog("Cause added to cache",t),t}async updateCause(e,t){await this.updateListItem("Causes",e,t);let s=this._causes.findIndex(r=>r.Id===e);s!==-1&&(this._causes[s]=a(a({},this._causes[s]),t),this.logger.debugLog("Cause updated in cache",{causeId:e}))}async deleteCause(e){await this.deleteListItem("Causes",e),this._causes=this._causes.filter(t=>t.Id!==e),this.logger.debugLog("Cause deleted from cache",{causeId:e})}async addConsequence(e){let t=await this.addListItem("Consequences",e);return this._consequences.push(t),this.logger.debugLog("Consequence added to cache",t),t}async updateConsequence(e,t){await this.updateListItem("Consequences",e,t);let s=this._consequences.findIndex(r=>r.Id===e);s!==-1&&(this._consequences[s]=a(a({},this._consequences[s]),t),this.logger.debugLog("Consequence updated in cache",{consequenceId:e}))}async deleteConsequence(e){await this.deleteListItem("Consequences",e),this._consequences=this._consequences.filter(t=>t.Id!==e),this.logger.debugLog("Consequence deleted from cache",{consequenceId:e})}async addControl(e){let t=await this.addListItem("Controls",e);return this._controls.push(t),this.logger.debugLog("Control added to cache",t),t}async updateControl(e,t){await this.updateListItem("Controls",e,t);let s=this._controls.findIndex(r=>r.Id===e);s!==-1&&(this._controls[s]=a(a({},this._controls[s]),t),this.logger.debugLog("Control updated in cache",{controlId:e}))}async deleteControl(e){await this.deleteListItem("Controls",e),this._controls=this._controls.filter(t=>t.Id!==e),this.logger.debugLog("Control deleted from cache",{controlId:e})}async addControlComment(e){let t=await this.addListItem("ControlComments",e);return this._controlComments.push(t),this.logger.debugLog("ControlComment added to cache",t),t}async updateControlComment(e,t){await this.updateListItem("ControlComments",e,t);let s=this._controlComments.findIndex(r=>r.Id===e);s!==-1&&(this._controlComments[s]=a(a({},this._controlComments[s]),t),this.logger.debugLog("ControlComment updated in cache",{commentId:e}))}async deleteControlComment(e){await this.deleteListItem("ControlComments",e),this._controlComments=this._controlComments.filter(t=>t.Id!==e),this.logger.debugLog("ControlComment deleted from cache",{commentId:e})}async addControlImpact(e){let t=await this.addListItem("ControlImpact",e);return this._controlImpact.push(t),this.logger.debugLog("ControlImpact added to cache",t),t}async updateControlImpact(e,t){await this.updateListItem("ControlImpact",e,t);let s=this._controlImpact.findIndex(r=>r.Id===e);s!==-1&&(this._controlImpact[s]=a(a({},this._controlImpact[s]),t),this.logger.debugLog("ControlImpact updated in cache",{impactId:e}))}async deleteControlImpact(e){await this.deleteListItem("ControlImpact",e),this._controlImpact=this._controlImpact.filter(t=>t.Id!==e),this.logger.debugLog("ControlImpact deleted from cache",{impactId:e})}selectRisk(e){this.logger.debugLog("Selecting risk",{riskId:e});let t=null;for(let s=0;s<this._risks.length;s++)if(this._risks[s].Id===e){t=this._risks[s];break}if(!t)return this.logger.debugLog("Risk not found",{riskId:e}),this._selectedRisk=null,this._selectedRiskSubject.next(null),null;if(this._selectedRisk=m(a({},t),{Objective:null,Causes:[],Consequences:[],Controls:[],Treatments:[],ControlComments:[],ControlImpact:[]}),t.OrgDivision){let s=t.Id.toString().padStart(3,"0");this._selectedRisk.CompositeId=`R${s}${t.OrgDivision}`}else this._selectedRisk.CompositeId=null;if(t.ParentId){for(let s=0;s<this._objectives.length;s++)if(this._objectives[s].Id===t.ParentId){this._selectedRisk.Objective=this._objectives[s];break}}for(let s=0;s<this._causes.length;s++)this._causes[s].ParentId===e&&this._selectedRisk.Causes.push(this._causes[s]);for(let s=0;s<this._consequences.length;s++)this._consequences[s].ParentId===e&&this._selectedRisk.Consequences.push(this._consequences[s]);for(let s=0;s<this._controls.length;s++)this._controls[s].ParentId===e&&this._selectedRisk.Controls.push(this._controls[s]);for(let s=0;s<this._treatments.length;s++)this._treatments[s].ParentId===e&&this._selectedRisk.Treatments.push(this._treatments[s]);for(let s=0;s<this._controlComments.length;s++)this._controlComments[s].ParentId===e&&this._selectedRisk.ControlComments.push(this._controlComments[s]);for(let s=0;s<this._controlImpact.length;s++)this._controlImpact[s].ParentId===e&&this._selectedRisk.ControlImpact.push(this._controlImpact[s]);return this.logger.debugLog("Risk selected with associated items",{riskId:e,compositeId:this._selectedRisk.CompositeId||"Not set",objective:this._selectedRisk.Objective?.Title||"None",causesCount:this._selectedRisk.Causes.length,consequencesCount:this._selectedRisk.Consequences.length,controlsCount:this._selectedRisk.Controls.length,treatmentsCount:this._selectedRisk.Treatments.length,controlCommentsCount:this._selectedRisk.ControlComments.length,controlImpactCount:this._selectedRisk.ControlImpact.length}),this._selectedRiskSubject.next(this._selectedRisk),this._selectedRisk}clearSelectedRisk(){this.logger.debugLog("Clearing selected risk"),this._selectedRisk=null,this._selectedRiskSubject.next(null)}selectObjective(e){this.logger.debugLog("Selecting objective",{objectiveId:e});let t=null;for(let s=0;s<this._objectives.length;s++)if(this._objectives[s].Id===e){t=this._objectives[s];break}if(!t)return this.logger.debugLog("Objective not found",{objectiveId:e}),this._selectedObjective=null,this._selectedObjectiveSubject.next(null),null;this._selectedObjective=m(a({},t),{Risks:[]});for(let s=0;s<this._risks.length;s++)this._risks[s].ParentId===e&&this._selectedObjective.Risks.push(this._risks[s]);return this.logger.debugLog("Objective selected with associated items",{objectiveId:e,title:this._selectedObjective.Title,risksCount:this._selectedObjective.Risks.length}),this._selectedObjectiveSubject.next(this._selectedObjective),this._selectedObjective}clearSelectedObjective(){this.logger.debugLog("Clearing selected objective"),this._selectedObjective=null,this._selectedObjectiveSubject.next(null)}static \u0275fac=function(t){return new(t||n)(U(V))};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};function Q(n,e){n&1&&p(0,"div",2)}var K=new T("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var pe=(()=>{class n{_elementRef=h(O);_ngZone=h(f);_changeDetectorRef=h(F);_renderer=h(A);_cleanupTransitionEnd;constructor(){let t=N(),s=h(K,{optional:!0});this._isNoopAnimation=t==="di-disabled",t==="reduced-motion"&&this._elementRef.nativeElement.classList.add("mat-progress-bar-reduced-motion"),s&&(s.color&&(this.color=this._defaultColor=s.color),this.mode=s.mode||this.mode)}_isNoopAnimation;get color(){return this._color||this._defaultColor}set color(t){this._color=t}_color;_defaultColor="primary";get value(){return this._value}set value(t){this._value=W(t||0),this._changeDetectorRef.markForCheck()}_value=0;get bufferValue(){return this._bufferValue||0}set bufferValue(t){this._bufferValue=W(t||0),this._changeDetectorRef.markForCheck()}_bufferValue=0;animationEnd=new E;get mode(){return this._mode}set mode(t){this._mode=t,this._changeDetectorRef.markForCheck()}_mode="determinate";ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._cleanupTransitionEnd=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._transitionendHandler)})}ngOnDestroy(){this._cleanupTransitionEnd?.()}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}_transitionendHandler=t=>{this.animationEnd.observers.length===0||!t.target||!t.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))};static \u0275fac=function(s){return new(s||n)};static \u0275cmp=D({type:n,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(s,r){s&2&&($("aria-valuenow",r._isIndeterminate()?null:r.value)("mode",r.mode),B("mat-"+r.color),X("_mat-animation-noopable",r._isNoopAnimation)("mdc-linear-progress--animation-ready",!r._isNoopAnimation)("mdc-linear-progress--indeterminate",r._isIndeterminate()))},inputs:{color:"color",value:[2,"value","value",S],bufferValue:[2,"bufferValue","bufferValue",S],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],decls:7,vars:5,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(s,r){s&1&&(v(0,"div",0),p(1,"div",1),z(2,Q,1,0,"div",2),y(),v(3,"div",3),p(4,"span",4),y(),v(5,"div",5),p(6,"span",4),y()),s&2&&(_(),w("flex-basis",r._getBufferBarFlexBasis()),_(),M(r.mode==="buffer"?2:-1),_(),w("transform",r._getPrimaryBarTransform()))},styles:[`.mat-mdc-progress-bar{--mat-progress-bar-animation-multiplier: 1;display:block;text-align:start}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}.mat-progress-bar-reduced-motion{--mat-progress-bar-animation-multiplier: 2}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:max(var(--mat-progress-bar-track-height, 4px),var(--mat-progress-bar-active-indicator-height, 4px))}@media(forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:var(--mat-progress-bar-active-indicator-height, 4px)}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}[dir=rtl] .mdc-linear-progress__bar{right:0;transform-origin:center right}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid;border-color:var(--mat-progress-bar-active-indicator-color, var(--mat-sys-primary));border-top-width:var(--mat-progress-bar-active-indicator-height, 4px)}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden;height:var(--mat-progress-bar-track-height, 4px);border-radius:var(--mat-progress-bar-track-shape, var(--mat-sys-corner-none))}.mdc-linear-progress__buffer-dots{background-image:radial-gradient(circle, var(--mat-progress-bar-track-color, var(--mat-sys-surface-variant)) calc(var(--mat-progress-bar-track-height, 4px) / 2), transparent 0);background-repeat:repeat-x;background-size:calc(calc(var(--mat-progress-bar-track-height, 4px) / 2)*5);background-position:left;flex:auto;transform:rotate(180deg);animation:mdc-linear-progress-buffering calc(250ms*var(--mat-progress-bar-animation-multiplier)) infinite linear}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}[dir=rtl] .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse calc(250ms*var(--mat-progress-bar-animation-multiplier)) infinite linear;transform:rotate(0)}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);background-color:var(--mat-progress-bar-track-color, var(--mat-sys-surface-variant))}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate calc(2s*var(--mat-progress-bar-animation-multiplier)) infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale calc(2s*var(--mat-progress-bar-animation-multiplier)) infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate calc(2s*var(--mat-progress-bar-animation-multiplier)) infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale calc(2s*var(--mat-progress-bar-animation-multiplier)) infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mat-progress-bar-track-height, 4px) * -2.5))}}@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(83.67142%)}100%{transform:translateX(200.611057%)}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(84.386165%)}100%{transform:translateX(160.277782%)}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(-83.67142%)}100%{transform:translateX(-200.611057%)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(-37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(-84.386165%)}100%{transform:translateX(-160.277782%)}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}
`],encapsulation:2,changeDetection:0})}return n})();function W(n,e=0,t=100){return Math.max(e,Math.min(t,n))}var be=(()=>{class n{static \u0275fac=function(s){return new(s||n)};static \u0275mod=q({type:n});static \u0275inj=x({imports:[H]})}return n})();var k=class{_box;_destroyed=new L;_resizeSubject=new L;_resizeObserver;_elementObservables=new Map;constructor(e){this._box=e,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(t=>this._resizeSubject.next(t)))}observe(e){return this._elementObservables.has(e)||this._elementObservables.set(e,new I(t=>{let s=this._resizeSubject.subscribe(t);return this._resizeObserver?.observe(e,{box:this._box}),()=>{this._resizeObserver?.unobserve(e),s.unsubscribe(),this._elementObservables.delete(e)}}).pipe(P(t=>t.some(s=>s.target===e)),R({bufferSize:1,refCount:!0}),j(this._destroyed))),this._elementObservables.get(e)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}},we=(()=>{class n{_cleanupErrorListener;_observers=new Map;_ngZone=h(f);constructor(){typeof ResizeObserver<"u"}ngOnDestroy(){for(let[,t]of this._observers)t.destroy();this._observers.clear(),this._cleanupErrorListener?.()}observe(t,s){let r=s?.box||"content-box";return this._observers.has(r)||this._observers.set(r,new k(r)),this._observers.get(r).observe(t)}static \u0275fac=function(s){return new(s||n)};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();export{we as a,G as b,pe as c,be as d};
